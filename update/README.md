# 更新日志

这里尽可能详尽地记录了系统功能上所发生的变化。

## 名词说明

本系统有三种客户端，也称之为展现端。他们分别是：

- 手机端：给所有的现场观众使用的，观众使用这个来参与游戏。
- 投影幕：现场投影仪将投放我们的系统，将显示关于问题的所有信息。
- 后台：社团工作人员使用的，用来出题、管理、监控的程序。

---

## 2018年

2018年由于工作的原因没有做大量的修改，只是基于 2017 年版本的一个修缮，修复了部分bug。

### 体验优化

1. 现在使用 iPhone 的用户不会觉得部分按钮的字体特别细了。

2. 现在投影幕每一次题目结算之后出现的勋章会更小一点，以保证能够让4个勋章同时出现在屏幕上。

### 技术变化

1. 兼容了 Mysql 5.7
---
## 2017年

### 平衡性调整

1. 题目不再限制可以进入的人数，所有人都能进入题目中进行抢答。

2. 限制进入题目的人数现在变为**幸运儿人数**，每道题只有规定的幸运儿人数能够获得加分。
> 假设一道题目中规定了幸运儿人数为10人，那么，在100个人里面，只有**最先提交答案并且回答正确的前10个人**才能够获得加分。

3. 每次答题中，提交答案速度排在全场15%`[round(全场人数*0.15)]`之后的人需要被扣除题目规定的分数。
> 只有 答错、答题超时、没有作答的人 扣分，即使处在于15%之后，但是答对了，是不会使用上述规则的

4. 每次答题中，提交答案速度排在全场前85%(即1-15%)的人中，不答，答题超时需要被扣除题目规定的分数。

5. 每次答题中，提交答案速度排在全场前85%(即1-15%)的人中，答错的人会被扣除自身分数的5%。
> 除非你的分数小于等于15分，高于15分就使用上面的规则，一般而言，“扣除自身分数5%” 不会比 “扣除题目规定分数” 扣除的多。

6. 当系统检测到玩家连续不输入验证码2次，就会被扣除 题目规定扣分的1.5倍分数。

### 体验优化

1. 每次结算分数时，将显示 A、B、C、D 四个选项全场玩家选择的比例。

2. 每次结算分数将在投影幕上出现该道题的荣誉勋章，分别是：
    - 最快手速(fastPlayer)：最快进入验证码的玩家；
    - 最先答对(firstCorrectPlayer)：第一个答对该题目的玩家；
    - 突飞猛进(blackHorse)：排名变化最大，而且排名变化大于60人的玩家。(从第五题开始才会有这个勋章出现)；
    - 弹无虚发(highHitRate)：答题准确率最高的玩家(每10题会出现一次这个选项)。
    
3. 当玩家消极比赛时，会在玩家游戏界面上给予提示。

4. 现在每个玩家都可以知道自己的加扣分原因了，在玩家界面上点击 **“分数”** 便可以看到。

### 后台功能变化
1. 手机操控投影幕针对每一个题目的操作，从之前的四个操作按钮(显示广告、显示验证码、显示题目、显示答案)变成了一个操作按钮(下一步)。
2. 现在后台可以查看每一个玩家的答题情况，每道题的正误。


### 技术变化

1. 系统前后端半分离，现在采用了 `gulp` 进行编译处理静态资源文件，保证部署系统时所有的文件的占用大小都是最小化的。

2. 所有前端请求将统一向 `api` 文件夹中的 php 代码请求。

3. 分离出 `model` 层，所有数据库操作都基于 `model` 层。

4. 数据库的连接方案从 `mysql` 改到了用 `mysqli`。

5. 数据库新增 `question_player_history` 表，用来记录玩家历年的成绩分数等信息。

6. 现在往数据库中填入时间时，将采用数据库方法插入时间，而不是在php上计算好时间再插入数据库。

7. 数据库时间精确到微秒。

8. 现在php只有一个入口文件，采用 `klein` 做了路由。
---

## 2016年

### 平衡性调整

1. 刻意以不输入验证码来逃避答题，将被视为消极行为。

> 旧版本中，不进入抢答就不会被扣分，2015年有人在达到高名次之后，选择不进入抢答，从游戏开始就没回答问题，最终取得了大奖。

2. 奖金余数将会被正确发放到幸运儿手中。

> 假设1000元奖金被前面 N 名同学瓜分剩下 X 元，而第 N+1 名同学的得分是 Y 分 （Y > X）。按照兑换原则，千元奖金分完即止，这 N + 1 名同学应该得到剩下的 X 元。
> 而 2015 年没有分掉剩下的 X 元。

3. 毫秒级的抢答先后顺序判别。

> 2015年系统判别抢答先后顺序的精度只达到了秒级，这意味着1秒内很多人几乎是同时答题的，然后这部分人因为是同时，所以采用了姓名拼音字母表进行排序，这是十分不合理的，所以改掉了。

### 体验优化

1. 如果是往年来参加过的选手，注册时填写的资料与往年相同，它将得到一个友善的 “欢迎回归” 提示。
2. 手机端上分数变化做了小动画效果。
3. 如果直接在微信中打开我们的系统，会给出请在浏览器中打开的提醒。
4. 投影幕上分数排名出现变化，将显示那个人相较于上一次分数多或少或者没变化的图标。
5. 投影幕页面完全整改，拥有较为完善的动画效果。
6. 投影幕页面，最终排行榜，把 1、2、3 名和其他获奖选手的效果区分开来。

### 后台功能变化
1. 添加了解封禁后台，提供给现场工作人员为那些操作不当的同学解封账号，同时还可以监视哪些同学有作弊行为趋势。
2. 手机操控投影幕再也不会有因为多次按按钮而导致的分数结算过于多次。
> 2015 年服务器不给力，导致了按下 `结算按钮` 之后系统没反应，工作人员误以为没按到 `结算按钮` ，故多按了几次，在网络通畅以后，系统也将分数结算了很多次。还好及时对数据库数据进行了回复。

### 技术变化

1. 投影幕页面从 `php` 改用成了 `nodejs` 实现。
2. 本来在手机端切换各个答题页面是前端发送 `ajax` 到后端，后端再返回 `html` 给前端，现在所有的 `html` 内容写在了 **前端**，后端和前端的沟通采用 `json` 进行数据交换。
3. 数据库将记录一次活动中，每一道题用户的 **排名（historyranking）**
4. 数据库将记录一次活动中，每一道题用户答题得到或扣除的 **分数（historyscore）**
5. 数据库将记录每一个用户 **总共参与过哪次答疯抢的年份(participateyears)** 、 **每一次参加得到的分数(historydata)** 、 **最后一次参赛的年份(lastactiveyear)**
6. 数据库将记录每一个用户因为没有输入验证码而被扣除的分数总和，以防出现闪失，才有挽救的机会。
7. 对数据库的某些关键列设置了 索引，加速每一次的检索。（手动设置的，不是程序自动设置）
8. 添加了毫秒级的时间判别。
9. `php` 中很多用来传输的信息都进行了 `json化` ，方便调试也方便开发。
10. 数据库新增了 `question_idcinputtime` 表，用来记录 验证码在大屏幕上出现的时间 到 用户输入验证码并提交的时间 之间的时间跨度。用于监视作弊倾向，同时为明年的活动做准备。

---